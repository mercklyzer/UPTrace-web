<div class="container">
    <h2>Patients</h2>

    <form [formGroup]="filterForm">
        <div class="row">
            <div class="col-md-3">
                <select class="form-select" formControlName="status_filter">
                    <option value="all" selected>All</option>
                    <option value="suspected">Suspected</option>
                    <option value="disclosed positive">Disclosed Positive</option>
                    <option value="confirmed positive">Confirmed Positive</option>
                    <option value="confirmed negative">Confirmed Negative</option>
                </select>
            </div>
            <div class="col-md-3">
                <dp-date-picker theme="dp-material" formControlName="date_filter" [config]="datePickerConfig" [placeholder]="datePlaceholder"></dp-date-picker>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-primary" (click)="getPatients()">Submit Filter</button>
            </div>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Contact Number</th>
                    <th scope="col">Preferred Contact Time</th>
                    <th scope="col">Preferred Way of Interview</th>
                    <th scope="col">Close Contacts</th>
                    <th scope="col">Whereabouts</th>
                    <th scope="col">Status</th>
                    <th scope="col">Contacted?</th>
                </tr>
            </thead>
            <p *ngIf="patients.length == 0" class='mt-2'>No patients.</p>
            <tbody>
                <tr *ngFor="let patient of patients">
                    <td>{{ patient.contact_num }}</td>
                    <td>{{ patient.contact_start_time }} - {{ patient.contact_end_time }}</td>
                    <td>{{ patient.way_of_interview }}</td>
                    <td>
                        <button type="button" class="btn btn-primary" routerLink="/patients/{{ patient.contact_num }}/dates/{{ patient.disclosure_date }}/close-contacts">View Close Contacts</button>
                    </td>
                    <td>
                        <a type="button" class="btn btn-primary" routerLink="/patients/{{ patient.contact_num }}/dates/{{ patient.disclosure_date }}/whereabouts">View Whereabouts</a>
                    </td>
                    <td>

                        <select class="form-select" (change)="onChangeStatus($event, patient)">
                            <option value="patient.status" selected disabled>{{ patient.status | titlecase }}</option>
                            <option value="confirmed positive" [hidden]="patient.status == 'confirmed positive' || patient.status == 'confirmed negative'">Confirmed Positive</option>
                            <option value="confirmed negative" [hidden]="patient.status == 'confirmed negative'">Confirmed Negative</option>
                        </select>
                    </td>
                    <td *ngIf="patient.contact_tracer">Contacted by {{ patient.contact_tracer }}</td>
                    <td *ngIf="!patient.contact_tracer">
                        <input class="form-check-input" type="checkbox" id="contacted" (click)="onChangeContactTracer($event, patient)">
                        <label class="form-check-label" for="contacted">I contacted this patient</label>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
